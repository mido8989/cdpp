<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hyundaimotors.hmb.cdppapp.mapper.IFHMBINNOCEANCDPP0037Mapper">



    <insert id='insertObject' parameterType="IFHMBINNOCEANCDPP0037Dto" useGeneratedKeys="true" keyProperty="rowId" keyColumn="row_id">
        insert into landing.if_update_contact_in_wf
        (
            created
            , created_by
            , last_upd
            , last_upd_by
            , cnhexpirationdate
            , contactid
            , suppressallemails
            , suppressallsms
            , printedcard
        )
        values
        (
            now()
            , 'interface'
            , now()
            , 'interface'
            , to_date(#{cnheXpirationDate}, 'YYYY-MM-DD')
            , #{contactId}
            , #{suppressAllEmails}
            , #{suppressAllSMS}
            , case when lower(#{printedCard}) = 'false' then 'N' else 'Y' end
        )
    </insert>
    
    <insert id="insertAutoVehicle" parameterType="ListOfAutoVehicleDto" useGeneratedKeys="true" keyProperty="rowId" keyColumn="row_id">
        insert into landing.if_update_contact_in_wf_vehicle
        (
            created
            , created_by
            , last_upd
            , last_upd_by
            , vehicleid
            , relationshipstatus 
            , hmbrenavamcode
            , currentmileage
            , vehiclelicensenumber
        )
        values
            (
                now()
                , 'interface'
                , now()
                , 'interface'
                , #{vehicleId}
                , #{relationshipStatus}
                , #{hmbRenavamCode}
                , #{currentMileage}
                , #{vehicleLicenseNumber}
            )
    </insert>

    <insert id="insertHobby" parameterType="IFHMBINNOCEANCDPP0037Dto">
        insert into landing.if_update_contact_in_wf_hobby
        (
            par_row_id
            , created
            , created_by
            , last_upd
            , last_upd_by
            , hobbydescription
        )
        values
        <foreach collection="listOfContactHobby" item="item" separator=",">
            (
                #{rowId}
                , now()
                , 'interface'
                , now()
                , 'interface'
                , #{item.hobbyDescription}
            )
        </foreach>
    </insert>

    <insert id="insertSoccerTeam" parameterType="IFHMBINNOCEANCDPP0037Dto">
        insert into landing.if_update_contact_in_wf_soccerteam
        (
            par_row_id
            , created
            , created_by
            , last_upd
            , last_upd_by
            , soccerteam
        )
        values
        <foreach collection="listOfContactSoccerTeam" item="item" separator=",">
            (
                #{rowId}
                , now()
                , 'interface'
                , now()
                , 'interface'
                , #{item.soccerTeam}
            )
        </foreach>
    </insert>

    <insert id="insertSocialMedia" parameterType="IFHMBINNOCEANCDPP0037Dto">
        insert into landing.if_update_contact_in_wf_socialmedia
        (
            par_row_id
            , created
            , created_by
            , last_upd
            , last_upd_by
            , socialmedianame
            , socialmediauser
            , sourcecity
        )
        values
        <foreach collection="listOfContactSocialMedia" item="item" separator=",">
            (
                #{rowId}
                , now()
                , 'interface'
                , now()
                , 'interface'
                , #{item.socialMediaName}
                , #{item.socialMediaUser}
                , #{item.sourceCity}
            )
        </foreach>
    </insert> 


    <select id="getUpdateContactOutput" parameterType="IFHMBINNOCEANCDPP0037Dto" resultType="com.hyundaimotors.hmb.cdppapp.payload.IFHMBINNOCEANCDPP0037.UpdateContactOutput">
        select 
            pa.loyaltyexpirationdate__c  as cnheXpirationDate
            , pa.firstname as firstName
            , pa.lastname as lastName
            , pa.personbirthdate as birthDate
            , pc.gender__c as gender
            , pa.personhomephone as homePhone
            , pc.companyphone__c as workPhone
            , pa.personhomephone as cellPhone
            , pa.personemail as emailAddress
            , pc.emailoptyn__c as suppressAllEmails
            , pc.x_printed_card__c as printedCard
            , pc.x_amount_friends__c as amountFriends
            , pc.x_amount_children__c as amountChildren
            , pc.x_loyalty_optin_flg__c as loyaltyOPTINFla
            , pc.mailingstreet as streetAddress
            , pc.mailingstreet_2__c as streetAddress2
            , pc.mailingstreet_3__c as streetAddress3
            , pc.mailingcountry as county
            , pc.mailingcity as city
            , pc.mailingstate as state
            , pc.mailingpostalcode as postalCode
        from
            process.account pa
        join
            process.contact pc
        on
            pa.row_id = pc.account_row_id 
        where 
            pa.row_id = #{contactId}
    </select>
    
    <select id="getListVehicle" parameterType="hashMap" resultType="com.hyundaimotors.hmb.cdppapp.payload.IFHMBINNOCEANCDPP0037.ListOfAutoVehicle">
        select 
            vehicleid as vehicleId
            , relationshipstatus as relationshipStatus
            , hmbrenavamcode as HMBRenavamCode
            , currentmileage as currentMileage
            , vehiclelicensenumber as vehicleLicenseNumber
        from 
            landing.if_update_contact_in_wf_vehicle v 
        where 
            v.row_id in
            <foreach collection="VEHICLE_ID" item="item" index="idx" open="(" close=")" separator=",">
                cast(#{item} as Integer)
            </foreach>     
    </select>

    <select id="getListHobby" parameterType="IFHMBINNOCEANCDPP0037Dto" resultType="com.hyundaimotors.hmb.cdppapp.payload.IFHMBINNOCEANCDPP0037.ListOfContactHobby">
        select 
            hobbydescription as hobbyDescription
        from 
            landing.if_update_contact_in_wf_hobby h 
        where
            h.par_row_id = #{rowId}
    </select>
    
    <select id="getListSoccerTeam" parameterType="IFHMBINNOCEANCDPP0037Dto" resultType="com.hyundaimotors.hmb.cdppapp.payload.IFHMBINNOCEANCDPP0037.ListOfContactSoccerTeam">
        select 
            soccerteam as soccerTeam
        from 
            landing.if_update_contact_in_wf_soccerteam s 
        where 
            s.par_row_id = #{rowId}
    </select>

    <select id="getListSocialMedia" parameterType="IFHMBINNOCEANCDPP0037Dto" resultType="com.hyundaimotors.hmb.cdppapp.payload.IFHMBINNOCEANCDPP0037.ListOfContactSocialMedia">
        select 
            socialmedianame as socialMediaName
            , socialmediauser as socialMediaUser
            , sourcecity as sourceCity
        from 
            landing.if_update_contact_in_wf_socialmedia s 
        where 
            s.par_row_id = #{rowId}
    </select>


    

    <insert id="transferProcess" statementType="CALLABLE" parameterType="hashMap">
        call process.if_update_contact_in_wf(#{PARAM_ID}, #{VEHICLE_ID}, #{ACCOUNT_ID});
    </insert>

    <!-- <select id="getCustomerVehicleId" parameterType="hashMap" resultType="String">
        select
            row_id
        from
            process.customer_vehicle
        where
            asset_id in 
            <foreach collection="ASSET_ID_LIST" item="item" index="idx" open="(" close=")" separator=",">
                #{item}
            </foreach>
    </select> -->

    <insert id="transferReplica" statementType="CALLABLE" parameterType="hashMap">
        call Replica.if_update_contact_in_wf(#{ASSET_ID_LIST}, #{ACCOUNT_ID});
    </insert>
</mapper>

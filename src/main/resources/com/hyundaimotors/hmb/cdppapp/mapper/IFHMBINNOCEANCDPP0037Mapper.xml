<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hyundaimotors.hmb.cdppapp.mapper.IFHMBINNOCEANCDPP0037Mapper">
    
    <update id="updateContact" parameterType="IFHMBINNOCEANCDPP0037Dto">
        update 
            landing.S_CONTACT 
        set
            SUPPRESS_EMAIL_FLG = #{suppressAllEmails}
            <!--, SUPPRESS_SMS_FLG = #{suppressAllSMS}-->
            , X_PRINTED_CARD = #{printedCard}
            , last_upd = now()
            , last_upd_by = 'interface'
        where 
            ROW_ID = #{contactId}
    </update>

    <update id="updateContactx" parameterType="IFHMBINNOCEANCDPP0037Dto">
        update 
            landing.S_CONTACT_X 
        set
            X_CNH_EXP_DATE = to_date(#{cnheXpirationDate},'YYYY-MM-DD')
        where 
            par_row_id = #{contactId}
    </update>

    <update id="updateContactHobby" parameterType="IFHMBINNOCEANCDPP0037Dto">
        <foreach collection="list" item="item" separator=";">
            update 
                landing.s_contact_xm 
            set
                last_upd = now()
                , last_upd_by = 'interface'
                , name = #{item.hobbyDescription}
            where
                par_row_id = #{item.hobbyContactId}
            and
                type = 'Hobby'
        </foreach>
    </update>

    <update id="updateSoccerTeam" parameterType="IFHMBINNOCEANCDPP0037Dto">
        <foreach collection="list" item="item" separator=";">
            update 
                landing.s_contact_xm 
            set
                last_upd = now()
                , last_upd_by = 'interface'
                , name = #{item.soccerTeam}
            where
                par_row_id = #{item.SoccerTeamContactId}
            and
                type = 'Soccer Team'
        </foreach>
    </update>

    <update id="updateContactSocialMedia" parameterType="IFHMBINNOCEANCDPP0037Dto">
        <foreach collection="list" item="item" separator=";">
            update 
                landing.s_contact_xm 
            set
                last_upd = now()
                , last_upd_by = 'interface'
                , name = #{item.socialMediaName}
                , X_SOC_MED_USER = #{item.socialMediaUser}
                , X_SOURCE_CITY = #{item.sourceCity}
            where
                par_row_id = #{item.socialMediaContactId}
            and
                type = 'Social Media'
        </foreach>
    </update>

    <select id="getUpdateContactOutput" parameterType="IFHMBINNOCEANCDPP0037Dto" resultType="com.hyundaimotors.hmb.cdppapp.payload.IFHMBINNOCEANCDPP0037.UpdateContactOutput">
        select 
            c.x_cnh_exp_date__c as cnheXpirationDate
            , c.firstname as firstName
            , c.lastname as lastName
            , c.birthdate as birthDate
            , c.gender__c as gender
            , c.homephone as homePhone
            , c.companyphone__c as workPhone
            , c.mobilephone as cellPhone
            , c.email as emailAddress
            , c.emailoptyn__c as suppressAllEmails
            , c.x_printed_card__c as printedCard
            , c.x_amount_friends__c as amountFriends
            , c.x_amount_children__c as amountChildren
            , c.x_loyalty_optin_flg__cas loyaltyOPTINFla
            , c.mailingstreet as streetAddress
            , c.mailingstreet_2__c as streetAddress2
            , c.mailingstreet_3__c as streetAddress3
            , c.mailingcountry as county
            , c.mailingcity as city
            , c.mailingstate as state
            , c.mailingpostalcode as postalCode
        from
            process.contact c
        where 
            c.external_id__c = #{contactId}
    </select>

    <select id="getListHobby" parameterType="IFHMBINNOCEANCDPP0037Dto" resultType="com.hyundaimotors.hmb.cdppapp.payload.IFHMBINNOCEANCDPP0037.ListOfContactHobby">
        select 
            NAME as hobbyDescription
        from 
            landing.s_contact_xm scx 
        where 
            scx.par_row_id = #{contactId}
        and
            scx.type = 'Hobby'
    </select>

    <select id="getListSoccerTeam" parameterType="IFHMBINNOCEANCDPP0037Dto" resultType="com.hyundaimotors.hmb.cdppapp.payload.IFHMBINNOCEANCDPP0037.ListOfContactSoccerTeam">
        select 
            NAME as soccerTeam
        from 
            landing.s_contact_xm scx 
        where 
            scx.par_row_id = #{contactId}
        and
            scx.type = 'Soccer Team'
    </select>

    <select id="getListSocialMedia" parameterType="IFHMBINNOCEANCDPP0037Dto" resultType="com.hyundaimotors.hmb.cdppapp.payload.IFHMBINNOCEANCDPP0037.ListOfContactSocialMedia">
        select 
            NAME as soccerTeam
            , X_SOC_MED_USER as socialMediaUser
            , X_SOURCE_CITY as sourceCity
        from 
            landing.s_contact_xm scx 
        where 
            scx.par_row_id = #{contactId}
        and
            scx.type = 'Social Media'
    </select>

    <insert id="transferProcess" statementType="CALLABLE" parameterType="hashMap">
        call process.hmb_update_contact_in_wf(#{PARAM_ID,jdbcType=VARCHAR,mode=IN});
    </insert>

    <select id="getAcountAndContactId" parameterType="IFHMBINNOCEANCDPP0037Dto" resultType="IFHMBINNOCEANCDPP0037Dto">
        select
            a.row_id as replicaAccountRowId
            , c.row_id as replicaContactRowId
        from 
            process.account a 
        join
            process.contact c 
        on
            a.row_id = c.account_row_id 
        where 
            a.external_id__c = #{contactId}
    </select>

    <insert id="transferReplica" statementType="CALLABLE" parameterType="hashMap">
        call Replica.hmb_update_contact_in_wf(#{PARAM_ID,jdbcType=VARCHAR,mode=IN});
    </insert>
</mapper>
